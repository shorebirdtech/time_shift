name: Shorebird Patch

on:
  push:
  workflow_dispatch:

jobs:
  create_patch:
    defaults:
      run:
        shell: bash

    runs-on: macos-latest

    steps:
      - name: 📚 Git Checkout
        uses: actions/checkout@v3

      - name: 🐦 Setup Shorebird
        uses: shorebirdtech/setup-shorebird@v0

      - name: Choose Clock Face
        run: |
          # Choose a clock face based on the current hour
          # Even hours = particle
          # Odd hours = generative
          current_hour=$(date +%H)
          if [ $(($current_hour % 2)) -eq "0" ]; then
            clock_face=particle
          else
            clock_face=generative
          fi
          echo "Using clock face $clock_face"
          echo "clock_face=$clock_face" >> $GITHUB_ENV

      - name: ✨ Create Patch
        run: shorebird patch android --force -- --dart-define clock_face=${{ env.clock_face }}
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
